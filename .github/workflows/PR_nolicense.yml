# This workflow uses `pull_request` which does not have access to a WLS license, it is just safer to use
# and will be started for any newly opened PRs or when a change is pushed to the PR.
#
# Since the WLS license is missing, this workflow runs a limited set of tests:
# - It skips the examples target in tox,
# - In pytest, some tests are annotated as needing a WLS license. These are automatically skipped.

name: build and test PR, no license

on:
  pull_request:

permissions:
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v5
      - name: Lint
        uses: ./.github/actions/lint

  test:
    needs: lint
    runs-on: ubuntu-latest
    timeout-minutes: 45
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.10", "3.11", "3.12", "3.13"]
        gurobi-version: ["gurobi11","gurobi12","gurobi13"]
        exclude:
          - python-version: "3.13"
            gurobi-version: "gurobi11"
    steps:
      - uses: actions/checkout@v5
      - name: Setup Python
        uses: ./.github/actions/setup-python-and-install
        with:
          python-version: ${{ matrix.python-version }}
      - name: Setup uv
        uses: astral-sh/setup-uv@v7
      - name: Test with tox (uv), excluding the examples target
        env:
          GUROBI_VERSION: ${{ matrix.gurobi-version }}
        run: |
          uvx tox
